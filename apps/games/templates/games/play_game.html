{% extends 'base.html' %}

{% block title %}Playing: {{ game.title }}{% endblock %}

{% block content %}
<div id="game-container" class="bg-white shadow-lg rounded-2xl p-6 md:p-8 max-w-4xl mx-auto"
    data-game-id="{{ game.id }}"
    data-game-type="{{ game.game_type }}">

    <div id="game-header" class="border-b pb-4 mb-6">
        <div class="flex justify-between items-center">
            <div>
                <h1 class="text-3xl font-bold text-gray-900">{{ game.title }}</h1>
                <p class="text-gray-600 mt-1">{{ game.subject.name }}</p>
            </div>
            <div class="flex items-center gap-6 text-lg">
                <div class="text-center">
                    <div class="text-xs text-gray-500">SCORE</div>
                    <div id="score" class="font-bold text-brand-purple">0</div>
                </div>
                <div class="text-center">
                    <div class="text-xs text-gray-500">TIME</div>
                    <div id="timer" class="font-bold text-brand-purple font-mono">00:00</div>
                </div>
            </div>
        </div>
        <div class="w-full bg-gray-200 rounded-full h-2.5 mt-4">
            <div id="progress-bar" class="bg-brand-purple h-2.5 rounded-full" style="width: 0%"></div>
        </div>
    </div>

    <div id="game-area" class="min-h-[300px] flex items-center justify-center">
        <div class="text-center text-gray-500">Loading Game...</div>
    </div>

    <div id="game-controls" class="mt-8 flex justify-between items-center">
        <div class="text-sm font-medium text-gray-500">Question <span id="question-counter">0/0</span></div>
        <div>
            <button id="submit-game-btn" class="hidden rounded-md bg-green-600 px-6 py-3 text-base font-medium text-white shadow-sm hover:bg-green-500 transition-colors">Finish Game</button>
            <button id="next-question-btn" class="rounded-md bg-brand-purple px-6 py-3 text-base font-medium text-white shadow-sm hover:bg-opacity-90 transition-colors">Next Question</button>
        </div>
    </div>
</div>

<div id="result-modal" class="hidden fixed inset-0 bg-gray-800 bg-opacity-75 flex items-center justify-center p-4 z-50">
    <div class="relative bg-white rounded-lg shadow-xl p-8 max-w-sm w-full text-center">
        <div class="mx-auto flex items-center justify-center h-16 w-16 rounded-full bg-green-100">
            <svg class="h-10 w-10 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path></svg>
        </div>
        <h3 class="text-2xl mt-4 font-semibold text-gray-900">Game Over!</h3>
        <div class="mt-4 space-y-2">
            <p class="text-lg text-gray-600">Your final score: <strong id="modal-score" class="text-brand-purple"></strong></p>
            <p class="text-lg text-gray-600">XP Earned: <strong id="modal-xp" class="text-brand-purple"></strong></p>
            <div id="modal-badges" class="mt-3 text-yellow-500 font-semibold"></div>
        </div>
        <div class="mt-6">
            <a href="{% url 'users:dashboard' %}" class="block w-full rounded-md bg-brand-purple px-4 py-2 text-base font-medium text-white shadow-sm hover:bg-opacity-90">
                Back to Dashboard
            </a>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script src="/static/js/game_engine.js"></script>
{% endblock %}